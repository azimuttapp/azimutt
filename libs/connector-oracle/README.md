# Oracle connector

This library allows to connect to [Oracle](https://www.oracle.com/database), extract its schema and more...

It lists all schemas, tables, columns, relations and types and format them in a JSON Schema.

This library is made by [Azimutt](https://azimutt.app) to allow people to explore their Oracle database.
It's accessible through the [Desktop app](../../desktop) (soon), the [CLI](https://www.npmjs.com/package/azimutt) or even the website using the [gateway](../../gateway) server.

**Feel free to use it and even submit PR to improve it:**

- improve [Oracle queries](./src/oracle.ts) (look at `getSchema` function)

## Publish

- update `package.json` version
- update lib versions (`pnpm -w run update` + manual)
- test with `pnpm run dry-publish` and check `azimutt-connector-oracle-x.y.z.tgz` content
- launch `pnpm publish --no-git-checks --access public`

View it on [npm](https://www.npmjs.com/package/@azimutt/connector-oracle).

## Dev

If you need to develop on multiple libs at the same time (ex: want to update a connector and try it through the CLI), depend on local libs but publish & revert before commit.

- Depend on a local lib: `pnpm add <lib>`, ex: `pnpm add @azimutt/models`
- "Publish" lib locally by building it: `pnpm run build`

## Oracle Setup

### 1. Run in Docker

You can use the [Oracle Database free version](https://container-registry.oracle.com/ords/ocr/ba/database), launch the container with `oracle` password for the `SYSTEM` user (using `ORACLE_PWD`):

```bash
docker run -d --name oracle_sample -p 1521:1521 -e ORACLE_PWD=oracle container-registry.oracle.com/database/free:23.4.0.0-lite
```

or

```bash
docker run -d --name oracle_sample -p 1521:1521 -e ORACLE_PWD=oracle container-registry.oracle.com/database/free:latest
```

### 2. Setup your database

Connect with host (`localhost`), port (`1521`), user (`SYSTEM`) and pass (`oracle`), then create a user and grand useful rights:

```oracle
CREATE USER C##azimutt IDENTIFIED BY azimutt;
GRANT UNLIMITED TABLESPACE TO C##azimutt;
CREATE ROLE C##azimutt_role;
GRANT CREATE SESSION, CREATE TABLE, CREATE SEQUENCE, CREATE VIEW, CREATE MATERIALIZED VIEW, CREATE TRIGGER to C##azimutt_role;
GRANT C##azimutt_role TO C##azimutt;
```

### 3. Fill your database

Connect with host (`localhost`), port (`1521`), user (`C##azimutt`) and pass (`azimutt`), then add some tables and data:

```oracle
CREATE TABLE users (
    id              NUMBER GENERATED BY DEFAULT AS IDENTITY,
    name            VARCHAR2(50)            NOT NULL,
    role            VARCHAR2(10)            NOT NULL,
    email           VARCHAR2(255)           NOT NULL,
    email_confirmed BOOLEAN   DEFAULT false NOT NULL,
    created_at      TIMESTAMP DEFAULT systimestamp,
    PRIMARY KEY (id)
);
COMMENT ON TABLE users IS 'List all users';
COMMENT ON COLUMN users.name IS 'The user name';

CREATE VIEW admins AS SELECT id, name, email FROM users WHERE role = 'admin';
COMMENT ON TABLE admins IS 'Only admins';

CREATE MATERIALIZED VIEW guests AS SELECT id, name, email FROM users WHERE role = 'guest';
COMMENT ON MATERIALIZED VIEW guests IS 'Only guests';


INSERT INTO users (name, role, email) VALUES ('Lo√Øc', 'admin', 'loic@mail.com');
INSERT INTO users (name, role, email) VALUES ('Jean', 'guest', 'jean@mail.com');
INSERT INTO users (name, role, email) VALUES ('Luc', 'guest', 'luc@mail.com');
```

You can now use Azimutt to connect to your database using this url: `oracle:thin:C##azimutt/azimutt@localhost:1521`
